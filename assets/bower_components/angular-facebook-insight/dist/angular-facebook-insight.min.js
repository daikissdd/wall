/*! angular-facebook-insight - v0.6.1 - 2014-07-13
* Copyright (c) 2014 ; Licensed  */
"use strict";var page_id=0;angular.module("angular-facebook-insight",["nvd3ChartDirectives","googlechart"]).service("Facebook",function(){var a=function(a,b,c){a.getLoginStatus(function(){a.api("/me",function(a){resolve(null,a,deferred)}),a.api("/me/accounts?access_token="+c,function(a){var c=[];for(var d in a.data)c[d]=a.data[d];b.monitoredPages=c,b.$apply()})})};return{getUserAndAccount:function(b,c){b.getLoginStatus(function(d){"connected"!==d.status?b.login(function(){b.api("/me",function(a){c.user=a,c.user.connected=!0,c.$apply()});var d=b.getAuthResponse().accessToken;a(b,c,d)},{scope:"read_insights,manage_pages"}):"connected"===d.status&&b.api("/me",function(d){c.user=d,c.user.connected=!0,c.$apply();var e=b.getAuthResponse().accessToken;a(b,c,e)})})}}}).directive("facebookInsight",function(){var a={};return a.restrict="EA",a.templateUrl="facebook-insight.html",a.scope={overview:"=overview",todaystats:"=todaystats",reach:"=reach",sources:"=sources",referrals:"=referrals",stories:"=stories",geographics:"=geographics",fans:"=fans",negativefeed:"=negativefeed",roi:"=roi"},a}).controller("MainCtrl",function(a,b){b.getUserAndAccount(FB,a)}).controller("nvd3Ctrl",function(a){a.overview={},a.todaystats={},a.reach={},a.sources={},a.referrals={},a.stories={},a.geographics={},a.fans={},a.negativefeed={},a.roi={};var b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=[],p=[],q=[],r=[],s=[];a.getPageInfo=function(t){page_id=t;var u=d3.selectAll(" svg");u.remove(),a.overview.pageid=page_id,FB.api("/"+page_id,function(){var t=[],u=[];FB.api("/"+page_id,function(b){a.overview.generalinfodata.push({name:"Website",info:b.website}),a.overview.generalinfodata.push({name:"Category",info:b.category}),a.overview.generalinfodata.push({name:"description",info:b.description}),a.todaystats.talkingaboutstats=b.talking_about_count,a.$apply()});var v=FB.getAuthResponse().accessToken;FB.api("/"+page_id+"/insights/page_fans_country/lifetime?access_token="+v,function(a){for(var b=function(a){var b=1,c=[];c[0]="Country";var d=[];d[0]="Fans";var e=a.data[0].values[0].value;for(var f in e)c[b]=f,d[b]=e[f],b+=1;return[c,d]},c=b(a),d=c[0],e=c[1],f=[],g=0;g<d.length;g++)f[g]=[d[g],e[g]];google.load("visualization","1",{packages:["geochart"]});var h=function(a){var b=google.visualization.arrayToDataTable(a),c={width:550,height:420},d=new google.visualization.GeoChart(document.getElementById("chart_div"));d.draw(b,c)};google.setOnLoadCallback(h(f))}),FB.api("/"+page_id+"/insights/page_impressions_by_locale_unique/days_28?access_token="+v,function(b){var c=function(a){var b=0,c=[],d=[],e=a.data[0].values[0].value;for(var f in e)c[b]=f,d[b]=e[f],b+=1;return[c,d]},d=c(b),e=d[0];q=d[1];for(var f=0;f<e.length;f++){var g={key:e[f],y:q[f]};r.push(g)}a.geographics.xFunction=function(){return function(a){return a.key}},a.geographics.yFunction=function(){return function(a){return a.y}},a.geographics.languagedata=r,a.$apply()}),FB.api("/"+page_id+"/insights/page_impressions_by_age_gender_unique/days_28?access_token="+v,function(b){var c=function(a){var b=0,c=[],d=[],e=a.data[0].values[0].value;for(var f in e)c[b]=f,d[b]=e[f],b+=1;return[c,d]},d=c(b),e=d[0];o=d[1];for(var f=0;f<e.length;f++){var g={key:e[f],y:o[f]};p.push(g)}a.fans.xFunction=function(){return function(a){return a.key}},a.fans.yFunction=function(){return function(a){return a.y}},a.fans.fanagegenderdata=p,a.$apply()}),FB.api("/"+page_id+"/insights/page_fans_online/day?access_token="+v,function(b){var c=function(a){var b=0,c=[],d=[],e=a.data[0].values[0].value;for(var f in e)c[b]=f,d[b]=e[f],b+=1;return[c,d]},d=c(b),e=d[0];s=d[1];var f=[];a.xFunction=function(){return function(a){return a.key}},a.yFunction=function(){return function(a){return a.y}};for(var g=0;g<e.length;g++)f[g]=[e[g],s[g]];a.$apply(function(){a.fans.fanonlinedata=[{key:"fans per hour",values:f}]})}),FB.api("/"+page_id+"/insights/page_views/day?access_token="+v,function(b){a.todaystats.todayviewstats=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_fans/lifetime?access_token="+v,function(b){a.todaystats.todaytotalfans=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_engaged_users/day?access_token="+v,function(b){a.todaystats.todayengagedusers=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_consumptions/day?access_token="+v,function(b){a.todaystats.todayclicks=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_fans_online_per_day/day?access_token="+v,function(b){a.todaystats.todayonlinefans=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_negative_feedback_by_type_unique/week?access_token="+v,function(b){a.$apply(function(){a.negativefeed.unlikes=b.data[0].values[2].value.unlike_page_clicks})}),FB.api("/"+page_id+"/insights/page_negative_feedback_by_type_unique/week?access_token="+v,function(b){a.$apply(function(){a.negativefeed.reports=b.data[0].values[2].value.report_spam_clicks})}),FB.api("/"+page_id+"/insights/page_negative_feedback_by_type_unique/week?access_token="+v,function(b){a.$apply(function(){a.negativefeed.hiderequests=b.data[0].values[2].value.hide_all_clicks})}),FB.api("/"+page_id+"/insights/page_fans/lifetime?access_token="+v,function(b){a.roi.totalfans=b.data[0].values[0].value,FB.api("/"+page_id+"/insights/page_engaged_users/days_28?access_token="+v,function(b){a.roi.engagedusers=b.data[0].values[0].value,a.roi.engagementrate=(a.roi.engagedusers/a.roi.totalfans*100).toFixed(2),("undefined"==typeof a.roi.engagementrate||isNaN(a.roi.engagementrate)||"Infinity"===a.roi.impressionrate)&&(a.roi.engagementrate="No Data"),a.$apply(),FB.api("/"+page_id+"/insights/page_impressions/days_28?access_token="+v,function(b){a.roi.reachmonthcount=b.data[0].values[0].value,a.roi.reachrate=(a.roi.reachmonthcount/a.roi.totalfans).toFixed(2),("undefined"==typeof a.roi.reachrate||isNaN(a.roi.reachrate)||"Infinity"===a.roi.impressionrate)&&(a.roi.reachrate="No Data"),a.$apply(),FB.api("/"+page_id+"/insights/page_consumptions/days_28?access_token="+v,function(b){a.roi.impressionmonthcount=b.data[0].values[0].value,a.roi.impressionrate=(a.roi.impressionmonthcount/a.roi.totalfans*100).toFixed(2),("undefined"==typeof a.roi.impressionrate||isNaN(a.roi.impressionrate)||"Infinity"===a.roi.impressionrate)&&(a.roi.impressionrate="No Data"),a.$apply()})})})}),a.pageInfo=t,a.overview.generalinfodata=u,a.$apply(),FB.api("/"+page_id+"/insights/page_impressions_organic/day?access_token="+v,function(j){a.reach.organicdata=j.data[0].values[2].value,e[0]=j.data[0].values[0].value,e[1]=j.data[0].values[1].value,e[2]=j.data[0].values[2].value;for(var k=0;k<e.length;k++){(null==e[k]||isNaN(e))&&(e=0);var l=j.data[0].values[k].end_time,m=new Date(l),n=m.getTime();i[k]=n,null==i[k]&&(i=0)}FB.api("/"+page_id+"/insights/page_impressions_paid/day?access_token="+v,function(b){a.reach.paiddata=b.data[0].values[2].value,c[0]=b.data[0].values[0].value,c[1]=b.data[0].values[1].value,c[2]=b.data[0].values[2].value;for(var d=0;d<c.length;d++){(null==c[d]||isNaN(c[d]))&&(c=0);var e=b.data[0].values[d].end_time,f=new Date(e),h=f.getTime();g[d]=h,null==g[d]&&(g=0)}}),FB.api("/"+page_id+"/insights/page_impressions_viral/day?access_token="+v,function(b){a.reach.viraldata=b.data[0].values[2].value,d[0]=b.data[0].values[0].value,d[1]=b.data[0].values[1].value,d[2]=b.data[0].values[2].value;for(var c=0;c<d.length;c++){(null==d[c]||isNaN(d[c]))&&(d=0);var e=b.data[0].values[c].end_time,f=new Date(e),g=f.getTime();h[c]=g,null==h[c]&&(h=0)}}),FB.api("/"+page_id+"/insights/page_impressions/week?access_token="+v,function(j){b[0]=j.data[0].values[0].value,b[1]=j.data[0].values[1].value,b[2]=j.data[0].values[2].value;for(var k=0;k<b.length;k++){(null==b[k]||isNaN(b[k]))&&(b=0);var l=j.data[0].values[k].end_time,m=new Date(l),n=m.getTime();f[k]=n,null==f[k]&&(f=0)}a.toolTipContentFunction=function(){return function(a,b,c){return console.log("tooltip content"),"Super New Tooltip<h1>"+a+"</h1><p>"+c+" at "+b+"</p>"}},a.xrFunction=function(){return function(a){return a.key}};for(var o=[],p=[],q=[],r=[],s=0;s<b.length;s++)o[s]=[f[s],b[s]];for(s=0;s<e.length;s++)p[s]=[i[s],e[s]];for(s=0;s<c.length;s++)q[s]=[g[s],c[s]];for(s=0;s<d.length;s++)r[s]=[h[s],d[s]];a.reach.reachevolutiondata=[{key:"Total Reach",values:[[f[0],b[0]],[f[1],b[1]],[f[2],b[2]]]},{key:"Organic Reach",values:[[i[0],e[0]],[i[1],e[1]],[i[2],e[2]]]},{key:"Paid Reach",values:[[g[0],c[0]],[g[1],c[1]],[g[2],c[2]]]},{key:"Viral Reach",values:[[h[0],d[0]],[h[1],d[1]],[h[2],d[2]]]}],a.reach.xAxisTickFormatFunction=function(){return function(a){return d3.time.format("%x")(new Date(a))}},a.$apply()})}),FB.api("/"+page_id+"/insights/page_fans_by_like_source/day?access_token="+v,function(b){var c=b.data[0].values[0].value;j[0]={name:"suggest.",value:c.page_suggestion},j[1]={name:"page",value:c.page_profile},j[2]={name:"ads",value:c.ads},j[3]={name:"mobile",value:c.mobile},j[4]={name:"profile",value:c.profile_connect},j[5]={name:"extern.",value:c.external_connect},j[6]={name:"recommend.",value:c.recommended_pages},j[7]={name:"timeline",value:c.timeline};for(var d=[],e=0;e<j.length;e++)d[e]=[j[e].name,j[e].value];a.sources.likesources=[{key:"Like Sources",values:d}],a.$apply()}),FB.api("/"+page_id+"/insights/page_views_logout/day?access_token="+v,function(b){a.sources.page_views_logout=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_views_login/day?access_token="+v,function(b){a.sources.page_views_login=b.data[0].values[0].value,a.$apply()}),FB.api("/"+page_id+"/insights/page_views_unique/day?access_token="+v,function(b){a.sources.page_views_unique=b.data[0].values[0].value,a.$apply()});var w=[];w[0]=["Logged out users",a.sources.page_views_logout],w[1]=["Logged in users",a.sources.page_views_login],w[2]=["Unique Users",a.sources.page_fans_by_like_logout],a.sources.viewsources=[{key:"Like Sources",values:w}],a.$apply(),FB.api("/"+page_id+"/insights/page_views_internal_referrals?access_token="+v,function(b){var c=[];for(var d in b.data[0].values){var e=b.data[0].values[d];c[d]=e.value}a.referrals.internaldata=c,a.$apply()}),FB.api("/"+page_id+"/insights/page_views_external_referrals?access_token="+v,function(b){var c=[];for(var d in b.data[0].values){var e=b.data[0].values[d];c[d]=e.value}a.referrals.externaldata=c,a.$apply()}),FB.api("/"+page_id+"/insights/page_positive_feedback_by_type/week?access_token="+v,function(b){var c=b.data[0].values[0].value;k[0]={name:"rsvp",value:c.rsvp},k[1]={name:"link",value:c.link},k[2]={name:"comment",value:c.comment},k[3]={name:"claim",value:c.claim},k[4]={name:"answer",value:c.answer};for(var d=[],e=0;e<k.length;e++)d[e]=[k[e].name,k[e].value];a.stories.positivefeedbackdata=[{key:"positivefeedbackdata",values:d}],a.$apply()}),FB.api("/"+page_id+"/insights/page_story_adds_by_story_type/week?access_token="+v,function(b){var c=b.data[0].values[0].value;l[0]={name:"mention",value:c.mention},l[1]={name:"question",value:c.question},l[2]={name:"fan",value:c.fan},l[3]={name:"U post",value:c.user_post},l[4]={name:"P post",value:c.page_post},l[5]={name:"Other.",value:c.other};for(var d=[],e=0;e<l.length;e++)d[e]=[l[e].name,l[e].value];a.stories.talkingaboutdata=[{key:"Like Sources",values:d}],a.$apply()}),FB.api("/"+page_id+"/insights/page_storytellers/week?access_token="+v,function(b){for(var c in b.data[0].values){var d=b.data[0].values[c];m[c]=d.value;for(var e=0;m>e;e++)(null==m||isNaN(m))&&(m=0);var f=b.data[0].values[c].end_time,g=new Date(f),h=g.getTime();n[c]=h}for(var i=[],j=0;j<m.length;j++)i[j]=[n[j],m[j]];a.stories.interactiondata=[{key:"people interaction",values:i}]}),a.stories.xAxisTickFormatFunction=function(){return function(a){return d3.time.format("%x")(new Date(a))}},a.$apply()})}});